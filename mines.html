<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DAG Mines - Bet & Win</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; padding: 20px; }
        .balance-area { background: #222; padding: 10px; border-radius: 10px; margin-bottom: 20px; color: #f7941d; font-weight: bold; }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; max-width: 320px; margin: 20px auto; }
        .cell { width: 58px; height: 58px; background: #333; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; border: 1px solid #444; }
        .cell.open.gem { background: #2ecc71; border-color: #27ae60; }
        .cell.open.bomb { background: #e74c3c; border-color: #c0392b; }
        .controls { background: #222; padding: 15px; border-radius: 15px; max-width: 320px; margin: 0 auto; }
        input { width: 80%; padding: 10px; margin: 10px 0; background: #333; border: 1px solid #444; color: white; border-radius: 8px; text-align: center; }
        button { width: 100%; padding: 15px; margin: 5px 0; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-start { background: #f7941d; color: white; }
        .btn-cashout { background: #2ecc71; color: white; display: none; }
    </style>
</head>
<body>
    <div class="balance-area">–í–ê–®–ê –°–¢–ê–í–ö–ê: <span id="current-bet">0</span> ‚≠ê</div>
    
    <div class="controls" id="setup-area">
        <label>–°—Ç–∞–≤–∫–∞ (–≤ –∑–≤–µ–∑–¥–∞—Ö):</label><br>
        <input type="number" id="bet-input" value="10" min="1">
        <button class="btn-start" onclick="startGame()">–ò–ì–†–ê–¢–¨</button>
    </div>

    <div id="game-area" style="display:none;">
        <div id="mult-display" style="font-size: 20px; color: #2ecc71; margin-bottom: 10px;">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x1.00</div>
        <div class="grid" id="grid"></div>
        <button id="cashout-btn" class="btn-cashout" onclick="cashOut()">–ó–ê–ë–†–ê–¢–¨ <span id="win-amount">0</span> ‚≠ê</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let bet = 0;
        let bombs = [];
        let gemsFound = 0;
        let isGameOver = false;

        function startGame() {
            bet = parseInt(document.getElementById('bet-input').value);
            if (isNaN(bet) || bet <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É!");

            // –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ
            document.getElementById('setup-area').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            document.getElementById('current-bet').innerText = bet;
            
            initGrid();
        }

        function initGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            bombs = [];
            gemsFound = 0;
            isGameOver = false;

            while(bombs.length < 3) {
                let r = Math.floor(Math.random() * 25);
                if(!bombs.includes(r)) bombs.push(r);
            }

            for(let i=0; i<25; i++) {
                let cell = document.createElement('div');
                cell.className = 'cell';
                cell.onclick = () => openCell(i, cell);
                grid.appendChild(cell);
            }
        }

        function openCell(idx, el) {
            if(isGameOver || el.classList.contains('open')) return;
            el.classList.add('open');

            if(bombs.includes(idx)) {
                el.classList.add('bomb');
                el.innerText = 'üí£';
                gameOver(false);
            } else {
                el.classList.add('gem');
                el.innerText = 'üíé';
                gemsFound++;
                updateMultiplier();
                document.getElementById('cashout-btn').style.display = 'block';
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        function updateMultiplier() {
            // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–∞—Å—Ç–µ—Ç —Å –∫–∞–∂–¥—ã–º –∞–ª–º–∞–∑–æ–º
            let mult = (1 + (gemsFound * 0.25)).toFixed(2);
            document.getElementById('mult-display').innerText = "–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x" + mult;
            document.getElementById('win-amount').innerText = Math.floor(bet * mult);
        }

        function cashOut() {
            if(isGameOver) return;
            let finalWin = document.getElementById('win-amount').innerText;
            isGameOver = true;
            
            tg.HapticFeedback.notificationOccurred('success');
            alert("–í—ã –∑–∞–±—Ä–∞–ª–∏ " + finalWin + " –∑–≤–µ–∑–¥!");
            
            // –û–¢–ü–†–ê–í–ö–ê –î–ê–ù–ù–´–• –ë–û–¢–£
            tg.sendData(JSON.stringify({action: "win", amount: finalWin, bet: bet}));
            tg.close();
        }

        function gameOver(win) {
            isGameOver = true;
            tg.HapticFeedback.notificationOccurred('error');
            setTimeout(() => {
                alert("–ë–æ–º–±–∞! –°—Ç–∞–≤–∫–∞ " + bet + " –∑–≤–µ–∑–¥ —Å–≥–æ—Ä–µ–ª–∞.");
                tg.sendData(JSON.stringify({action: "loss", bet: bet}));
                tg.close();
            }, 500);
        }
    </script>
</body>
</html>
