<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DAG Mines - Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; max-width: 320px; margin: 20px auto; display: none; }
        .cell { width: 55px; height: 55px; background: #333; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 22px; cursor: pointer; border: 2px solid #444; transition: 0.2s; }
        .cell.open.gem { background: #2ecc71; border-color: #27ae60; box-shadow: 0 0 10px #2ecc71; }
        .cell.open.bomb { background: #e74c3c; border-color: #c0392b; }
        
        .menu { background: #222; padding: 20px; border-radius: 15px; border: 1px solid #444; }
        select, input { width: 90%; padding: 12px; margin: 10px 0; background: #333; border: 1px solid #555; color: white; border-radius: 8px; font-size: 16px; text-align: center; }
        
        button { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .btn-start { background: #f7941d; color: white; }
        .btn-cashout { background: #2ecc71; color: white; display: none; box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4); }
        
        #info { margin-bottom: 15px; font-size: 18px; color: #f7941d; font-weight: bold; }
        .label { font-size: 14px; color: #aaa; margin-top: 10px; display: block; }
    </style>
</head>
<body>

    <div id="setup-area" class="menu">
        <h2>üí£ DAG MINES</h2>
        
        <span class="label">–°–£–ú–ú–ê –°–¢–ê–í–ö–ò (‚≠ê)</span>
        <input type="number" id="bet-input" value="10" min="1">
        
        <span class="label">–£–†–û–í–ï–ù–¨ –°–õ–û–ñ–ù–û–°–¢–ò</span>
        <select id="difficulty">
            <option value="3">–õ–µ–≥–∫–æ (3 –º–∏–Ω—ã) - x1.12 –∑–∞ —Ö–æ–¥</option>
            <option value="5" selected>–°—Ä–µ–¥–Ω–µ (5 –º–∏–Ω) - x1.23 –∑–∞ —Ö–æ–¥</option>
            <option value="10">–°–ª–æ–∂–Ω–æ (10 –º–∏–Ω) - x1.65 –∑–∞ —Ö–æ–¥</option>
            <option value="15">–≠–∫—Å—Ç—Ä–∏–º (15 –º–∏–Ω) - x2.40 –∑–∞ —Ö–æ–¥</option>
        </select>
        
        <button class="btn-start" onclick="startGame()">–ò–ì–†–ê–¢–¨</button>
    </div>

    <div id="game-area">
        <div id="info">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="mult">x1.00</span></div>
        <div class="grid" id="grid"></div>
        <button id="cashout-btn" class="btn-cashout" onclick="cashOut()">–ó–ê–ë–†–ê–¢–¨ <span id="win-amount">0</span> ‚≠ê</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let bet = 0;
        let mineCount = 0;
        let bombs = [];
        let gemsFound = 0;
        let isGameOver = false;

        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ä–æ—Å—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π
        const growthRates = { "3": 0.12, "5": 0.23, "10": 0.65, "15": 1.40 };

        function startGame() {
            bet = parseInt(document.getElementById('bet-input').value);
            mineCount = parseInt(document.getElementById('difficulty').value);
            
            if (isNaN(bet) || bet <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É!");

            document.getElementById('setup-area').style.display = 'none';
            document.getElementById('grid').style.display = 'grid';
            initGrid();
        }

        function initGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            bombs = [];
            gemsFound = 0;
            isGameOver = false;

            // –†–ê–ù–î–û–ú–ù–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø –ú–ò–ù
            while(bombs.length < mineCount) {
                let randomPos = Math.floor(Math.random() * 25);
                if(!bombs.includes(randomPos)) bombs.push(randomPos);
            }

            for(let i=0; i<25; i++) {
                let cell = document.createElement('div');
                cell.className = 'cell';
                cell.onclick = () => openCell(i, cell);
                grid.appendChild(cell);
            }
        }

        function openCell(idx, el) {
            if(isGameOver || el.classList.contains('open')) return;
            el.classList.add('open');

            if(bombs.includes(idx)) {
                el.classList.add('bomb');
                el.innerText = 'üí•';
                endGame(false);
            } else {
                el.classList.add('gem');
                el.innerText = 'üíé';
                gemsFound++;
                tg.HapticFeedback.impactOccurred('light');
                updateUI();
            }
        }

        function updateUI() {
            let rate = growthRates[mineCount.toString()];
            // –§–æ—Ä–º—É–ª–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞
            let multiplier = (1 + (gemsFound * rate)).toFixed(2);
            let currentWin = Math.floor(bet * multiplier);
            
            document.getElementById('mult').innerText = "x" + multiplier;
            document.getElementById('win-amount').innerText = currentWin;
            document.getElementById('cashout-btn').style.display = 'block';
        }

        function cashOut() {
            if(isGameOver || gemsFound === 0) return;
            let win = document.getElementById('win-amount').innerText;
            endGame(true, win);
        }

        function endGame(isWin, amount = 0) {
            isGameOver = true;
            
            if(isWin) {
                tg.HapticFeedback.notificationOccurred('success');
                tg.sendData(JSON.stringify({action: "win", amount: parseInt(amount), bet: bet}));
            } else {
                tg.HapticFeedback.notificationOccurred('error');
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –º–∏–Ω—ã –ø–æ—Å–ª–µ –ø—Ä–æ–∏–≥—Ä—ã—à–∞
                bombs.forEach(pos => {
                    document.getElementById('grid').children[pos].classList.add('bomb');
                    document.getElementById('grid').children[pos].innerText = 'üí£';
                });
                setTimeout(() => {
                    tg.sendData(JSON.stringify({action: "loss", bet: bet}));
                    tg.close();
                }, 1000);
            }
        }
    </script>
</body>
</html>
