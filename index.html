<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DAG BIRD PREMIUM</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #202040; font-family: 'Arial', sans-serif; touch-action: none; }
        canvas { display: block; }
        
        /* –°—Ç–∏–ª—å–Ω–æ–µ –º–µ–Ω—é */
        #ui { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            background: linear-gradient(rgba(0,0,0,0.8), rgba(32,32,64,0.9)); z-index: 1000; 
        }
        .menu-box { 
            background: white; padding: 30px; border-radius: 25px; text-align: center; 
            width: 280px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); border: 4px solid #f7941d;
        }
        
        input { width: 80%; padding: 15px; margin: 15px 0; border-radius: 12px; border: 2px solid #ddd; font-size: 22px; text-align: center; outline: none; }
        button#start-btn { 
            background: #f7941d; color: white; border: none; padding: 18px; 
            border-radius: 12px; font-weight: bold; width: 100%; font-size: 20px; cursor: pointer;
            box-shadow: 0 5px 0 #c37517;
        }
        button#start-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #c37517; }
        
        #game-info { 
            position: absolute; top: 40px; width: 100%; text-align: center; 
            color: #fff; font-size: 28px; font-weight: 900; text-shadow: 3px 3px 0 #000; 
            display: none; z-index: 100; pointer-events: none;
        }
        
        #cashout-btn { 
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); 
            background: #2ecc71; color: white; border: none; padding: 22px 50px; 
            border-radius: 60px; font-size: 22px; font-weight: bold; 
            display: none; z-index: 1500; box-shadow: 0 8px 0 #1e8449; transition: 0.1s;
        }
        #cashout-btn:active { transform: translateX(-50%) translateY(4px); box-shadow: 0 4px 0 #1e8449; }
    </style>
</head>
<body>

    <div id="game-info">
        <span id="mult-val" style="color: #f1c40f; font-size: 40px;">x1.00</span><br>
        <span id="current-win">0</span> ‚≠ê
    </div>

    <button id="cashout-btn" onpointerdown="cashOut(event)">üí∞ –ó–ê–ë–†–ê–¢–¨ –í–´–ò–ì–†–´–®</button>

    <div id="ui">
        <div class="menu-box">
            <h1 style="margin: 0; color: #f7941d; font-size: 32px;">DAG BIRD</h1>
            <p style="color: #666;">–°—Ç–∞–≤–∫–∞ (–º–∏–Ω–∏–º—É–º 10 ‚≠ê)</p>
            <input type="number" id="bet-input" value="10" min="10">
            <button id="start-btn" onclick="startGame()">–í–ó–õ–ï–¢–ê–ï–ú!</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const ui = document.getElementById('ui');
        const cashoutBtn = document.getElementById('cashout-btn');
        const gameInfo = document.getElementById('game-info');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let bet = 0, multiplier = 1.0, isPlaying = false;
        let bird, pipes = [], frame = 0, particles = [];

        function startGame() {
            bet = parseInt(document.getElementById('bet-input').value);
            if (isNaN(bet) || bet < 10) return alert("–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ 10 ‚≠ê");

            ui.style.display = 'none';
            cashoutBtn.style.display = 'block';
            gameInfo.style.display = 'block';

            bird = { x: 80, y: canvas.height / 2, v: 0, r: 20, angle: 0 };
            pipes = []; multiplier = 1.0; frame = 0;
            isPlaying = true;
            animate();
        }

        function drawBackground() {
            // –ù–æ—á–Ω–æ–µ –Ω–µ–±–æ
            let g = ctx.createLinearGradient(0, 0, 0, canvas.height);
            g.addColorStop(0, '#0f0c29'); g.addColorStop(0.5, '#302b63'); g.addColorStop(1, '#24243e');
            ctx.fillStyle = g; ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –ó–≤–µ–∑–¥—ã
            ctx.fillStyle = "white";
            for(let i=0; i<30; i++) ctx.fillRect((i*137)%canvas.width, (i*251)%canvas.height, 2, 2);
        }

        function drawBird() {
            ctx.save();
            ctx.translate(bird.x, bird.y);
            bird.angle = Math.min(Math.PI/4, Math.max(-Math.PI/4, bird.v/12));
            ctx.rotate(bird.angle);

            // –ö—Ä—ã–ª–æ
            ctx.fillStyle = "#FFD700";
            ctx.beginPath(); ctx.ellipse(-10, 0, 12, 8, bird.angle, 0, Math.PI*2); ctx.fill();
            ctx.stroke();

            // –¢–µ–ª–æ (–ü—Ç–∏—Ü–∞)
            ctx.fillStyle = "#f1c40f";
            ctx.beginPath(); ctx.arc(0, 0, bird.r, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = "black"; ctx.lineWidth = 3; ctx.stroke();

            // –ì–ª–∞–∑
            ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(10, -8, 7, 0, Math.PI*2); ctx.fill(); ctx.stroke();
            ctx.fillStyle = "black"; ctx.beginPath(); ctx.arc(13, -8, 3, 0, Math.PI*2); ctx.fill();

            // –ö–ª—é–≤
            ctx.fillStyle = "#e67e22";
            ctx.beginPath(); ctx.moveTo(15, 0); ctx.lineTo(30, 5); ctx.lineTo(15, 10); ctx.closePath(); ctx.fill(); ctx.stroke();
            
            ctx.restore();
        }

        function drawPipes(p) {
            let g = ctx.createLinearGradient(p.x, 0, p.x + 60, 0);
            g.addColorStop(0, '#2ecc71'); g.addColorStop(0.5, '#a2fad1'); g.addColorStop(1, '#27ae60');
            ctx.fillStyle = g;
            ctx.lineWidth = 3;

            // –í–µ—Ä—Ö–Ω—è—è
            ctx.fillRect(p.x, 0, 60, p.top); ctx.strokeRect(p.x, 0, 60, p.top);
            ctx.fillRect(p.x-5, p.top-25, 70, 25); ctx.strokeRect(p.x-5, p.top-25, 70, 25);

            // –ù–∏–∂–Ω—è—è
            ctx.fillRect(p.x, canvas.height - p.bottom, 60, p.bottom); ctx.strokeRect(p.x, canvas.height - p.bottom, 60, p.bottom);
            ctx.fillRect(p.x-5, canvas.height - p.bottom, 70, 25); ctx.strokeRect(p.x-5, canvas.height - p.bottom, 70, 25);
        }

        function animate() {
            if (!isPlaying) return;
            drawBackground();

            bird.v += 0.3; bird.y += bird.v;

            if (frame % 85 === 0) {
                let gap = 180, h = Math.random() * (canvas.height - gap - 250) + 120;
                pipes.push({ x: canvas.width, top: h, bottom: canvas.height - h - gap, passed: false });
            }

            pipes.forEach(p => {
                p.x -= 4;
                drawPipes(p);

                // –ö–æ–ª–ª–∏–∑–∏—è
                if (bird.x + 15 > p.x && bird.x - 15 < p.x + 60) {
                    if (bird.y - 15 < p.top || bird.y + 15 > canvas.height - p.bottom) gameOver();
                }

                if (p.x < bird.x && !p.passed) {
                    p.passed = true; multiplier += 0.25;
                    tg.HapticFeedback.impactOccurred('medium');
                    updateUI();
                }
            });

            pipes = pipes.filter(p => p.x > -100);
            if (bird.y + 20 > canvas.height || bird.y - 20 < 0) gameOver();

            drawBird();
            frame++;
            requestAnimationFrame(animate);
        }

        function updateUI() {
            document.getElementById('mult-val').innerText = "x" + multiplier.toFixed(2);
            document.getElementById('current-win').innerText = Math.floor(bet * multiplier);
        }

        function cashOut(e) {
            if (e) { e.preventDefault(); e.stopPropagation(); }
            if (!isPlaying) return;
            const win = Math.floor(bet * multiplier);
            isPlaying = false;
            tg.sendData(JSON.stringify({ action: "win", bet: bet, amount: win }));
            tg.HapticFeedback.notificationOccurred('success');
            setTimeout(() => location.reload(), 100);
        }

        function gameOver() {
            if (!isPlaying) return;
            isPlaying = false;
            tg.sendData(JSON.stringify({ action: "loss", bet: bet }));
            tg.HapticFeedback.notificationOccurred('error');
            alert("–ü–†–û–ò–ì–†–´–®! –°—Ç–∞–≤–∫–∞ –ø–æ—Ç–µ—Ä—è–Ω–∞.");
            location.reload();
        }

        const jump = (e) => { 
            if(isPlaying) { bird.v = -6.5; } 
            if(e) e.preventDefault();
        };
        window.addEventListener('keydown', (e) => { if(e.code === 'Space') jump(e); });
        canvas.addEventListener('pointerdown', jump);
    </script>
</body>
</html>
