<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DAG Mines</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; text-align: center; margin: 0; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; max-width: 300px; margin: 20px auto; }
        .cell { width: 55px; height: 55px; background: #333; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; transition: 0.2s; }
        .cell.open { background: #444; cursor: default; }
        .cell.bomb { background: #e74c3c; }
        .cell.gem { background: #2ecc71; }
        .status { margin-bottom: 20px; font-size: 18px; color: #f7941d; }
        button { padding: 15px 30px; background: #f7941d; border: none; border-radius: 12px; color: white; font-weight: bold; font-size: 18px; }
        .multiplier { font-size: 24px; margin: 10px; color: #2ecc71; }
    </style>
</head>
<body>
    <h1>üí£ –ú–ò–ù–´</h1>
    <div class="status" id="stat">–ù–∞–∂–º–∏ –°–¢–ê–†–¢ (1 —ç–Ω–µ—Ä–≥–∏—è)</div>
    <div class="multiplier" id="mult">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x1.0</div>
    <div class="grid" id="grid"></div>
    <button id="action-btn" onclick="startGame()">–ò–ì–†–ê–¢–¨</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let cells = [];
        let bombs = [];
        let gameOver = true;
        let gemsFound = 0;
        const totalBombs = 3;

        function startGame() {
            // –í –∏–¥–µ–∞–ª–µ —Ç—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –±–æ—Ç—É –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É —ç–Ω–µ—Ä–≥–∏–∏
            document.getElementById('grid').innerHTML = '';
            document.getElementById('stat').innerText = "–ù–∞–π–¥–∏ –∞–ª–º–∞–∑—ã!";
            document.getElementById('action-btn').style.display = 'none';
            document.getElementById('mult').innerText = "–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x1.0";
            gameOver = false;
            gemsFound = 0;
            bombs = [];
            cells = [];

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–æ–º–±—ã
            while(bombs.length < totalBombs) {
                let r = Math.floor(Math.random() * 25);
                if(!bombs.includes(r)) bombs.push(r);
            }

            for(let i=0; i<25; i++) {
                let cell = document.createElement('div');
                cell.className = 'cell';
                cell.onclick = () => openCell(i, cell);
                document.getElementById('grid').appendChild(cell);
                cells.push(cell);
            }
        }

        function openCell(idx, el) {
            if(gameOver || el.classList.contains('open')) return;
            el.classList.add('open');

            if(bombs.includes(idx)) {
                el.classList.add('bomb');
                el.innerText = 'üí£';
                die();
            } else {
                el.classList.add('gem');
                el.innerText = 'üíé';
                gemsFound++;
                let m = (1 + gemsFound * 0.2).toFixed(1);
                document.getElementById('mult').innerText = "–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x" + m;
                if(gemsFound === 22) win();
            }
        }

        function die() {
            gameOver = true;
            document.getElementById('stat').innerText = "–ë–ê–ë–ê–•! –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª.";
            document.getElementById('action-btn').innerText = "–ü–û–ü–†–û–ë–û–í–ê–¢–¨ –°–ù–û–í–ê";
            document.getElementById('action-btn').style.display = 'inline-block';
            tg.HapticFeedback.notificationOccurred('error');
        }

        function win() {
            gameOver = true;
            document.getElementById('stat').innerText = "–ü–û–ë–ï–î–ê! –í—Å–µ –∞–ª–º–∞–∑—ã —Ç–≤–æ–∏!";
            document.getElementById('action-btn').style.display = 'inline-block';
            tg.HapticFeedback.notificationOccurred('success');
        }
    </script>
</body>
</html>